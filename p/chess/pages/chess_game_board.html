<!DOCTYPE html>

<html lang="id" class="scroll-smooth">

<head>

<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="ChessWeb - Permainan catur berbasis web dengan implementasi aturan lengkap">

<title>ChessWeb - Papan Permainan Catur</title>

<link rel="stylesheet" href="../css/main.css">


<script type="module" defer src="https://static.rocket.new/rocket-shot.js?v=0.0.2"></script>

</head>

<body class="min-h-screen bg-background">

<!-- Main Container -->

<div class="container-chess py-6 md:py-8">

<!-- Header Section -->

<header class="mb-6 md:mb-8 animate-fade-in">

<div class="flex items-center justify-between flex-wrap gap-4">

<div class="flex items-center gap-3">

<!-- Chess Logo SVG -->

<svg class="w-10 h-10 md:w-12 md:h-12" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">

<rect x="4" y="4" width="40" height="40" rx="4" fill="var(--color-primary)" opacity="0.1"/>

<path d="M24 8C24 8 20 12 20 16C20 18 21 19 22 20L20 32H28L26 20C27 19 28 18 28 16C28 12 24 8 24 8Z" fill="var(--color-primary)"/>

<ellipse cx="24" cy="34" rx="6" ry="2" fill="var(--color-primary)"/>

<circle cx="24" cy="12" r="2" fill="var(--color-accent)"/>

</svg>

<div>

<h1 class="text-2xl md:text-3xl font-heading font-bold text-primary">ChessWeb</h1>

<p class="text-sm text-text-secondary font-caption">Permainan Catur Klasik</p>

</div>

</div>

<!-- Theme Toggle Button -->

<button id="themeToggle" class="btn-ghost h-10 w-10 p-0 rounded-full" aria-label="Toggle dark mode">

<svg class="w-5 h-5 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>

</svg>

<svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>

</svg>

</button>

</div>

</header>


<!-- Main Game Layout -->

<div class="grid lg:grid-cols-[1fr_400px] gap-6 md:gap-8">

<!-- Left Column: Board and Status -->

<div class="space-y-4 md:space-y-6 animate-slide-up">

<!-- Game Status Panel -->

<div class="card">

<div class="flex items-center justify-between flex-wrap gap-4">

<div class="flex items-center gap-3">

<div id="currentPlayerIndicator" class="w-8 h-8 rounded-full border-4 border-primary bg-white shadow-md transition-all duration-300"></div>

<div>

<p class="text-sm text-text-secondary font-caption">Giliran Pemain</p>

<p id="currentPlayerText" class="text-lg font-semibold text-primary">Putih</p>

</div>

</div>

<div class="flex items-center gap-4">

<div class="text-right">

<p class="text-sm text-text-secondary font-caption">Jumlah Langkah</p>

<p id="moveCounter" class="text-lg font-semibold text-text-primary">0</p>

</div>

<div id="gameStatusBadge" class="badge badge-info hidden">

<span id="gameStatusText">Normal</span>

</div>

</div>

</div>

<!-- Game Message -->

<div id="gameMessage" class="mt-4 p-3 rounded-md bg-primary/5 border border-primary/20 hidden">

<p class="text-sm font-medium text-primary"></p>

</div>

</div>


<!-- Chess Board Container -->

<div class="card p-4 md:p-6">

<div class="max-w-2xl mx-auto">

<!-- Board Coordinates Top -->

<div class="flex justify-around mb-2 px-2">

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">a</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">b</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">c</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">d</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">e</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">f</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">g</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">h</span>

</div>

<div class="flex">

<!-- Left Coordinates -->

<div class="flex flex-col-reverse justify-around pr-2">

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">1</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">2</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">3</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">4</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">5</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">6</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">7</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">8</span>

</div>

<!-- Chess Board -->

<div id="chessBoard" class="chess-board w-full aspect-square" role="grid" aria-label="Papan catur">

<!-- Board squares will be generated by JavaScript -->

</div>

<!-- Right Coordinates -->

<div class="flex flex-col-reverse justify-around pl-2">

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">1</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">2</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">3</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">4</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">5</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">6</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">7</span>

<span class="text-xs font-mono text-text-secondary h-[12.5%] flex items-center">8</span>

</div>

</div>

<!-- Board Coordinates Bottom -->

<div class="flex justify-around mt-2 px-2">

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">a</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">b</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">c</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">d</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">e</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">f</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">g</span>

<span class="text-xs font-mono text-text-secondary w-[12.5%] text-center">h</span>

</div>

</div>

</div>


<!-- Control Panel (Mobile) -->

<div class="card lg:hidden">

<div class="flex gap-3">

<button id="resetGameMobile" class="btn-outline flex-1">

<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>

</svg>

Reset Permainan

</button>

<button id="newGameMobile" class="btn-primary flex-1">

<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>

</svg>

Permainan Baru

</button>

</div>

</div>

</div>


<!-- Right Column: Move History and Controls -->

<div class="space-y-4 md:space-y-6 animate-slide-up" style="animation-delay: 100ms;">

<!-- Control Panel (Desktop) -->

<div class="card hidden lg:block">

<h3 class="text-lg font-semibold text-text-primary mb-4">Kontrol Permainan</h3>

<div class="space-y-3">

<button id="resetGame" class="btn-outline w-full">

<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>

</svg>

Reset Permainan

</button>

<button id="newGame" class="btn-primary w-full">

<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>

</svg>

Permainan Baru

</button>

</div>

</div>


<!-- Move History -->

<div class="card">

<div class="flex items-center justify-between mb-4">

<h3 class="text-lg font-semibold text-text-primary">Riwayat Langkah</h3>

<span id="historyCount" class="badge badge-info">0 langkah</span>

</div>

<div id="moveHistory" class="move-history">

<div class="p-8 text-center text-text-tertiary">

<svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>

</svg>

<p class="text-sm">Belum ada langkah yang dimainkan</p>

</div>

</div>

</div>


<!-- Captured Pieces -->

<div class="card">

<h3 class="text-lg font-semibold text-text-primary mb-4">Bidak Tertangkap</h3>

<div class="space-y-4">

<!-- White Captured -->

<div>

<p class="text-xs text-text-secondary font-caption mb-2">Putih Tertangkap</p>

<div id="whiteCaptured" class="flex flex-wrap gap-2 min-h-[40px] p-2 rounded-md bg-secondary/5 border border-border">

<span class="text-xs text-text-tertiary">Tidak ada</span>

</div>

</div>

<!-- Black Captured -->

<div>

<p class="text-xs text-text-secondary font-caption mb-2">Hitam Tertangkap</p>

<div id="blackCaptured" class="flex flex-wrap gap-2 min-h-[40px] p-2 rounded-md bg-secondary/5 border border-border">

<span class="text-xs text-text-tertiary">Tidak ada</span>

</div>

</div>

</div>

</div>

</div>

</div>

</div>


<!-- Pawn Promotion Modal -->

<div id="promotionModal" class="modal hidden" role="dialog" aria-labelledby="promotionTitle" aria-modal="true">

<div class="modal-content">

<h2 id="promotionTitle" class="text-2xl font-heading font-bold text-primary mb-4">Promosi Pion</h2>

<p class="text-text-secondary mb-6">Pilih bidak untuk promosi pion Anda:</p>

<div class="grid grid-cols-2 gap-4">

<button class="promotion-choice btn-outline h-24 text-4xl hover:bg-primary hover:text-white transition-all" data-piece="queen">

<span class="promotion-piece">♕</span>

</button>

<button class="promotion-choice btn-outline h-24 text-4xl hover:bg-primary hover:text-white transition-all" data-piece="rook">

<span class="promotion-piece">♖</span>

</button>

<button class="promotion-choice btn-outline h-24 text-4xl hover:bg-primary hover:text-white transition-all" data-piece="bishop">

<span class="promotion-piece">♗</span>

</button>

<button class="promotion-choice btn-outline h-24 text-4xl hover:bg-primary hover:text-white transition-all" data-piece="knight">

<span class="promotion-piece">♘</span>

</button>

</div>

</div>

</div>


<!-- Game End Modal -->

<div id="gameEndModal" class="modal hidden" role="dialog" aria-labelledby="gameEndTitle" aria-modal="true">

<div class="modal-content text-center">

<div id="gameEndIcon" class="w-20 h-20 mx-auto mb-4 rounded-full bg-primary/10 flex items-center justify-center">

<svg class="w-10 h-10 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>

</svg>

</div>

<h2 id="gameEndTitle" class="text-3xl font-heading font-bold text-primary mb-2">Permainan Selesai!</h2>

<p id="gameEndMessage" class="text-lg text-text-secondary mb-6">Putih menang dengan skakmat!</p>

<div class="flex gap-3 justify-center">

<button id="viewGameEnd" class="btn-outline">

<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>

</svg>

Lihat Detail

</button>

<button id="newGameFromEnd" class="btn-primary">

<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>

</svg>

Permainan Baru

</button>

</div>

</div>

</div>


<script>

// Chess Game Logic

const ChessGame = {

board: [],

currentPlayer: 'white',

selectedSquare: null,

validMoves: [],

moveHistory: [],

capturedPieces: { white: [], black: [] },

gameState: 'active', // active, check, checkmate, stalemate

enPassantTarget: null,

castlingRights: {

white: { kingside: true, queenside: true },

black: { kingside: true, queenside: true }

},


// Unicode chess pieces

pieces: {

white: { king: '♔', queen: '♕', rook: '♖', bishop: '♗', knight: '♘', pawn: '♙' },

black: { king: '♚', queen: '♛', rook: '♜', bishop: '♝', knight: '♞', pawn: '♟' }

},


init() {

this.setupBoard();

this.renderBoard();

this.updateUI();

this.attachEventListeners();

},


setupBoard() {

// Initialize empty board

this.board = Array(8).fill(null).map(() => Array(8).fill(null));


// Setup pieces

const backRow = ['rook', 'knight', 'bishop', 'queen', 'king', 'bishop', 'knight', 'rook'];

// Black pieces

backRow.forEach((piece, col) => {

this.board[0][col] = { type: piece, color: 'black' };

});

for (let col = 0; col < 8; col++) {

this.board[1][col] = { type: 'pawn', color: 'black' };

}


// White pieces

for (let col = 0; col < 8; col++) {

this.board[6][col] = { type: 'pawn', color: 'white' };

}

backRow.forEach((piece, col) => {

this.board[7][col] = { type: piece, color: 'white' };

});

},


renderBoard() {

const boardElement = document.getElementById('chessBoard');

boardElement.innerHTML = '';


for (let row = 0; row < 8; row++) {

for (let col = 0; col < 8; col++) {

const square = document.createElement('div');

square.className = `chess-square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;

square.dataset.row = row;

square.dataset.col = col;

square.setAttribute('role', 'gridcell');

square.setAttribute('aria-label', `${String.fromCharCode(97 + col)}${8 - row}`);


const piece = this.board[row][col];

if (piece) {

const pieceElement = document.createElement('div');

pieceElement.className = 'chess-piece';

pieceElement.textContent = this.pieces[piece.color][piece.type];

pieceElement.setAttribute('aria-label', `${piece.color} ${piece.type}`);

square.appendChild(pieceElement);

}


boardElement.appendChild(square);

}

}

},


attachEventListeners() {

const board = document.getElementById('chessBoard');

board.addEventListener('click', (e) => {

const square = e.target.closest('.chess-square');

if (square) {

const row = parseInt(square.dataset.row);

const col = parseInt(square.dataset.col);

this.handleSquareClick(row, col);

}

});


// Control buttons

document.getElementById('resetGame')?.addEventListener('click', () => this.resetGame());

document.getElementById('resetGameMobile')?.addEventListener('click', () => this.resetGame());

document.getElementById('newGame')?.addEventListener('click', () => this.resetGame());

document.getElementById('newGameMobile')?.addEventListener('click', () => this.resetGame());

document.getElementById('newGameFromEnd')?.addEventListener('click', () => {

this.hideModal('gameEndModal');

this.resetGame();

});

document.getElementById('viewGameEnd')?.addEventListener('click', () => {

window.location.href = 'game_end_status_screen.html';

});


// Promotion modal

document.querySelectorAll('.promotion-choice').forEach(btn => {

btn.addEventListener('click', (e) => {

const piece = e.currentTarget.dataset.piece;

this.handlePromotion(piece);

});

});


// Theme toggle

document.getElementById('themeToggle')?.addEventListener('click', () => {

document.documentElement.classList.toggle('dark');

});

},


handleSquareClick(row, col) {

if (this.gameState !== 'active' && this.gameState !== 'check') return;


const piece = this.board[row][col];


// If a square is already selected

if (this.selectedSquare) {

const [selectedRow, selectedCol] = this.selectedSquare;

// Check if clicked square is a valid move

if (this.validMoves.some(move => move.row === row && move.col === col)) {

this.makeMove(selectedRow, selectedCol, row, col);

this.clearSelection();

return;

}

// Deselect if clicking same square or select new piece

this.clearSelection();

}


// Select new piece if it belongs to current player

if (piece && piece.color === this.currentPlayer) {

this.selectSquare(row, col);

}

},


selectSquare(row, col) {

this.selectedSquare = [row, col];

this.validMoves = this.getValidMoves(row, col);

this.highlightSquares();

},


clearSelection() {

this.selectedSquare = null;

this.validMoves = [];

this.renderBoard();

},


highlightSquares() {

this.renderBoard();

if (this.selectedSquare) {

const [row, col] = this.selectedSquare;

const squares = document.querySelectorAll('.chess-square');

const selectedSquare = squares[row * 8 + col];

selectedSquare.classList.add('selected');

selectedSquare.querySelector('.chess-piece')?.classList.add('selected');

}


this.validMoves.forEach(move => {

const squares = document.querySelectorAll('.chess-square');

const square = squares[move.row * 8 + move.col];

square.classList.add('valid-move');

});

},


getValidMoves(row, col) {

const piece = this.board[row][col];

if (!piece) return [];


let moves = [];


switch (piece.type) {

case 'pawn':

moves = this.getPawnMoves(row, col, piece.color);

break;

case 'rook':

moves = this.getRookMoves(row, col, piece.color);

break;

case 'knight':

moves = this.getKnightMoves(row, col, piece.color);

break;

case 'bishop':

moves = this.getBishopMoves(row, col, piece.color);

break;

case 'queen':

moves = this.getQueenMoves(row, col, piece.color);

break;

case 'king':

moves = this.getKingMoves(row, col, piece.color);

break;

}


// Filter out moves that would put king in check

return moves.filter(move => !this.wouldBeInCheck(row, col, move.row, move.col, piece.color));

},


getPawnMoves(row, col, color) {

const moves = [];

const direction = color === 'white' ? -1 : 1;

const startRow = color === 'white' ? 6 : 1;


// Forward move

if (this.isValidSquare(row + direction, col) && !this.board[row + direction][col]) {

moves.push({ row: row + direction, col });

// Double move from start

if (row === startRow && !this.board[row + 2 * direction][col]) {

moves.push({ row: row + 2 * direction, col });

}

}


// Captures

[-1, 1].forEach(offset => {

const newRow = row + direction;

const newCol = col + offset;

if (this.isValidSquare(newRow, newCol)) {

const target = this.board[newRow][newCol];

if (target && target.color !== color) {

moves.push({ row: newRow, col: newCol });

}

// En passant

if (this.enPassantTarget && 

this.enPassantTarget.row === newRow && 

this.enPassantTarget.col === newCol) {

moves.push({ row: newRow, col: newCol, enPassant: true });

}

}

});


return moves;

},


getRookMoves(row, col, color) {

return this.getLinearMoves(row, col, color, [

[-1, 0], [1, 0], [0, -1], [0, 1]

]);

},


getBishopMoves(row, col, color) {

return this.getLinearMoves(row, col, color, [

[-1, -1], [-1, 1], [1, -1], [1, 1]

]);

},


getQueenMoves(row, col, color) {

return this.getLinearMoves(row, col, color, [

[-1, 0], [1, 0], [0, -1], [0, 1],

[-1, -1], [-1, 1], [1, -1], [1, 1]

]);

},


getKnightMoves(row, col, color) {

const moves = [];

const offsets = [

[-2, -1], [-2, 1], [-1, -2], [-1, 2],

[1, -2], [1, 2], [2, -1], [2, 1]

];


offsets.forEach(([dRow, dCol]) => {

const newRow = row + dRow;

const newCol = col + dCol;

if (this.isValidSquare(newRow, newCol)) {

const target = this.board[newRow][newCol];

if (!target || target.color !== color) {

moves.push({ row: newRow, col: newCol });

}

}

});


return moves;

},


getKingMoves(row, col, color) {

const moves = [];

const offsets = [

[-1, -1], [-1, 0], [-1, 1],

[0, -1], [0, 1],

[1, -1], [1, 0], [1, 1]

];


offsets.forEach(([dRow, dCol]) => {

const newRow = row + dRow;

const newCol = col + dCol;

if (this.isValidSquare(newRow, newCol)) {

const target = this.board[newRow][newCol];

if (!target || target.color !== color) {

moves.push({ row: newRow, col: newCol });

}

}

});


// Castling

if (this.castlingRights[color].kingside && this.canCastle(row, col, color, 'kingside')) {

moves.push({ row, col: col + 2, castling: 'kingside' });

}

if (this.castlingRights[color].queenside && this.canCastle(row, col, color, 'queenside')) {

moves.push({ row, col: col - 2, castling: 'queenside' });

}


return moves;

},


getLinearMoves(row, col, color, directions) {

const moves = [];


directions.forEach(([dRow, dCol]) => {

let newRow = row + dRow;

let newCol = col + dCol;


while (this.isValidSquare(newRow, newCol)) {

const target = this.board[newRow][newCol];

if (!target) {

moves.push({ row: newRow, col: newCol });

} else {

if (target.color !== color) {

moves.push({ row: newRow, col: newCol });

}

break;

}

newRow += dRow;

newCol += dCol;

}

});


return moves;

},


canCastle(row, col, color, side) {

const rookCol = side === 'kingside' ? 7 : 0;

const direction = side === 'kingside' ? 1 : -1;

// Check if squares between king and rook are empty

const start = Math.min(col, rookCol) + 1;

const end = Math.max(col, rookCol);

for (let c = start; c < end; c++) {

if (this.board[row][c]) return false;

}


// Check if king passes through or ends in check

for (let c = col; c !== col + 2 * direction + direction; c += direction) {

if (this.isSquareUnderAttack(row, c, color)) return false;

}


return true;

},


makeMove(fromRow, fromCol, toRow, toCol) {

const piece = this.board[fromRow][fromCol];

const capturedPiece = this.board[toRow][toCol];

const move = this.validMoves.find(m => m.row === toRow && m.col === toCol);


// Handle captures

if (capturedPiece) {

this.capturedPieces[capturedPiece.color].push(capturedPiece.type);

this.updateCapturedPieces();

}


// Handle en passant

if (move?.enPassant) {

const capturedRow = this.currentPlayer === 'white' ? toRow + 1 : toRow - 1;

const capturedPawn = this.board[capturedRow][toCol];

this.capturedPieces[capturedPawn.color].push('pawn');

this.board[capturedRow][toCol] = null;

this.updateCapturedPieces();

}


// Handle castling

if (move?.castling) {

const rookFromCol = move.castling === 'kingside' ? 7 : 0;

const rookToCol = move.castling === 'kingside' ? toCol - 1 : toCol + 1;

this.board[toRow][rookToCol] = this.board[fromRow][rookFromCol];

this.board[fromRow][rookFromCol] = null;

}


// Move piece

this.board[toRow][toCol] = piece;

this.board[fromRow][fromCol] = null;


// Update castling rights

if (piece.type === 'king') {

this.castlingRights[piece.color].kingside = false;

this.castlingRights[piece.color].queenside = false;

}

if (piece.type === 'rook') {

if (fromCol === 0) this.castlingRights[piece.color].queenside = false;

if (fromCol === 7) this.castlingRights[piece.color].kingside = false;

}


// Set en passant target

this.enPassantTarget = null;

if (piece.type === 'pawn' && Math.abs(toRow - fromRow) === 2) {

this.enPassantTarget = { row: (fromRow + toRow) / 2, col: toCol };

}


// Check for pawn promotion

if (piece.type === 'pawn' && (toRow === 0 || toRow === 7)) {

this.showPromotionModal(toRow, toCol);

return;

}


// Record move

this.recordMove(fromRow, fromCol, toRow, toCol, piece, capturedPiece);


// Switch player

this.switchPlayer();

this.checkGameState();

this.updateUI();

},


showPromotionModal(row, col) {

const modal = document.getElementById('promotionModal');

modal.classList.remove('hidden');

modal.dataset.row = row;

modal.dataset.col = col;


// Update piece symbols based on color

const color = this.board[row][col].color;

document.querySelectorAll('.promotion-piece').forEach((el, index) => {

const pieces = ['queen', 'rook', 'bishop', 'knight'];

el.textContent = this.pieces[color][pieces[index]];

});

},


handlePromotion(pieceType) {

const modal = document.getElementById('promotionModal');

const row = parseInt(modal.dataset.row);

const col = parseInt(modal.dataset.col);

this.board[row][col].type = pieceType;

this.hideModal('promotionModal');

this.switchPlayer();

this.checkGameState();

this.updateUI();

},


recordMove(fromRow, fromCol, toRow, toCol, piece, captured) {

const from = String.fromCharCode(97 + fromCol) + (8 - fromRow);

const to = String.fromCharCode(97 + toCol) + (8 - toRow);

const notation = `${this.pieces[piece.color][piece.type]} ${from} → ${to}${captured ? ' ×' : ''}`;

this.moveHistory.push({

notation,

from: { row: fromRow, col: fromCol },

to: { row: toRow, col: toCol },

piece: piece.type,

color: piece.color,

captured: captured?.type

});


this.updateMoveHistory();

},


switchPlayer() {

this.currentPlayer = this.currentPlayer === 'white' ? 'black' : 'white';

},


checkGameState() {

const inCheck = this.isKingInCheck(this.currentPlayer);

const hasValidMoves = this.hasValidMoves(this.currentPlayer);


if (inCheck && !hasValidMoves) {

this.gameState = 'checkmate';

this.showGameEndModal('checkmate');

} else if (!inCheck && !hasValidMoves) {

this.gameState = 'stalemate';

this.showGameEndModal('stalemate');

} else if (inCheck) {

this.gameState = 'check';

this.showMessage(`Skak! ${this.currentPlayer === 'white' ? 'Putih' : 'Hitam'} dalam ancaman.`, 'warning');

} else {

this.gameState = 'active';

}

},


isKingInCheck(color) {

// Find king position

let kingPos = null;

for (let row = 0; row < 8; row++) {

for (let col = 0; col < 8; col++) {

const piece = this.board[row][col];

if (piece && piece.type === 'king' && piece.color === color) {

kingPos = { row, col };

break;

}

}

if (kingPos) break;

}


return this.isSquareUnderAttack(kingPos.row, kingPos.col, color);

},


isSquareUnderAttack(row, col, color) {

const opponentColor = color === 'white' ? 'black' : 'white';


for (let r = 0; r < 8; r++) {

for (let c = 0; c < 8; c++) {

const piece = this.board[r][c];

if (piece && piece.color === opponentColor) {

const moves = this.getValidMovesWithoutCheckValidation(r, c);

if (moves.some(move => move.row === row && move.col === col)) {

return true;

}

}

}

}


return false;

},


getValidMovesWithoutCheckValidation(row, col) {

const piece = this.board[row][col];

if (!piece) return [];


switch (piece.type) {

case 'pawn': return this.getPawnMoves(row, col, piece.color);

case 'rook': return this.getRookMoves(row, col, piece.color);

case 'knight': return this.getKnightMoves(row, col, piece.color);

case 'bishop': return this.getBishopMoves(row, col, piece.color);

case 'queen': return this.getQueenMoves(row, col, piece.color);

case 'king': return this.getKingMoves(row, col, piece.color).filter(m => !m.castling);

default: return [];

}

},


wouldBeInCheck(fromRow, fromCol, toRow, toCol, color) {

// Simulate move

const piece = this.board[fromRow][fromCol];

const captured = this.board[toRow][toCol];

this.board[toRow][toCol] = piece;

this.board[fromRow][fromCol] = null;


const inCheck = this.isKingInCheck(color);


// Undo move

this.board[fromRow][fromCol] = piece;

this.board[toRow][toCol] = captured;


return inCheck;

},


hasValidMoves(color) {

for (let row = 0; row < 8; row++) {

for (let col = 0; col < 8; col++) {

const piece = this.board[row][col];

if (piece && piece.color === color) {

const moves = this.getValidMoves(row, col);

if (moves.length > 0) return true;

}

}

}

return false;

},


showGameEndModal(result) {

const modal = document.getElementById('gameEndModal');

const title = document.getElementById('gameEndTitle');

const message = document.getElementById('gameEndMessage');

const icon = document.getElementById('gameEndIcon');


if (result === 'checkmate') {

const winner = this.currentPlayer === 'white' ? 'Hitam' : 'Putih';

title.textContent = `${winner} Menang!`;

message.textContent = `${winner} memenangkan permainan dengan skakmat!`;

icon.innerHTML = `<svg class="w-10 h-10 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>

</svg>`;

} else {

title.textContent = 'Permainan Seri!';

message.textContent = 'Permainan berakhir dengan stalemate (seri).';

icon.innerHTML = `<svg class="w-10 h-10 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>

</svg>`;

}


modal.classList.remove('hidden');

},


hideModal(modalId) {

document.getElementById(modalId).classList.add('hidden');

},


showMessage(text, type = 'info') {

const messageEl = document.getElementById('gameMessage');

const textEl = messageEl.querySelector('p');

textEl.textContent = text;

messageEl.classList.remove('hidden');

// Auto-hide after 3 seconds

setTimeout(() => {

messageEl.classList.add('hidden');

}, 3000);

},


updateUI() {

// Update current player

const playerText = document.getElementById('currentPlayerText');

const playerIndicator = document.getElementById('currentPlayerIndicator');

playerText.textContent = this.currentPlayer === 'white' ? 'Putih' : 'Hitam';

playerIndicator.style.backgroundColor = this.currentPlayer === 'white' ? '#FFFFFF' : '#2C2C2C';

playerIndicator.style.borderColor = this.currentPlayer === 'white' ? '#8B4513' : '#2C2C2C';


// Update move counter

document.getElementById('moveCounter').textContent = this.moveHistory.length;


// Update game status badge

const badge = document.getElementById('gameStatusBadge');

const statusText = document.getElementById('gameStatusText');

if (this.gameState === 'check') {

badge.classList.remove('hidden', 'badge-info');

badge.classList.add('badge-warning');

statusText.textContent = 'Skak!';

} else if (this.gameState === 'checkmate' || this.gameState === 'stalemate') {

badge.classList.remove('hidden', 'badge-info', 'badge-warning');

badge.classList.add('badge-error');

statusText.textContent = this.gameState === 'checkmate' ? 'Skakmat' : 'Stalemate';

} else {

badge.classList.add('hidden');

}


this.renderBoard();

},


updateMoveHistory() {

const historyEl = document.getElementById('moveHistory');

const countEl = document.getElementById('historyCount');

countEl.textContent = `${this.moveHistory.length} langkah`;


if (this.moveHistory.length === 0) {

historyEl.innerHTML = `

<div class="p-8 text-center text-text-tertiary">

<svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">

<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>

</svg>

<p class="text-sm">Belum ada langkah yang dimainkan</p>

</div>

`;

} else {

historyEl.innerHTML = this.moveHistory.map((move, index) => `

<div class="move-item">

<span class="text-text-tertiary">${index + 1}.</span>

<span class="text-text-primary ml-2">${move.notation}</span>

</div>

`).join('');

}

},


updateCapturedPieces() {

const whiteCaptured = document.getElementById('whiteCaptured');

const blackCaptured = document.getElementById('blackCaptured');


whiteCaptured.innerHTML = this.capturedPieces.white.length > 0

? this.capturedPieces.white.map(type => 

`<span class="text-2xl">${this.pieces.white[type]}</span>`

).join('')

: '<span class="text-xs text-text-tertiary">Tidak ada</span>';


blackCaptured.innerHTML = this.capturedPieces.black.length > 0

? this.capturedPieces.black.map(type => 

`<span class="text-2xl">${this.pieces.black[type]}</span>`

).join('')

: '<span class="text-xs text-text-tertiary">Tidak ada</span>';

},


resetGame() {

this.board = [];

this.currentPlayer = 'white';

this.selectedSquare = null;

this.validMoves = [];

this.moveHistory = [];

this.capturedPieces = { white: [], black: [] };

this.gameState = 'active';

this.enPassantTarget = null;

this.castlingRights = {

white: { kingside: true, queenside: true },

black: { kingside: true, queenside: true }

};


this.setupBoard();

this.renderBoard();

this.updateUI();

this.updateMoveHistory();

this.updateCapturedPieces();

},


isValidSquare(row, col) {

return row >= 0 && row < 8 && col >= 0 && col < 8;

}

};


// Initialize game when DOM is loaded

document.addEventListener('DOMContentLoaded', () => {

ChessGame.init();

});

</script>


</body>

</html>

